<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="icons/favicon.png">
    <link rel="stylesheet" href="styles/index.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <title>wplacer</title>
</head>

<body>
    <div class="container">
        <!-- Header with improved navigation -->
        <header class="app-header">
            <h1><img src="icons/favicon.png" alt="wplacer logo">wplacer</h1>
            <nav class="breadcrumb" id="breadcrumb">
                <span class="breadcrumb-item active">Dashboard</span>
            </nav>
        </header>

        <!-- Main Dashboard -->
        <div id="main" class="page-content">
            <div class="dashboard-grid">
                <div class="nav-card" data-section="users">
                    <div class="nav-card-icon">
                        <img src="icons/manageUsers.svg" alt="">
                    </div>
                    <div class="nav-card-content">
                        <h3>Manage Users</h3>
                        <p>Add and configure user accounts for template execution</p>
                    </div>
                    <button id="openManageUsers" class="nav-card-button primary-button">
                        Open <i data-feather="arrow-right"></i>
                    </button>
                </div>

                <div class="nav-card" data-section="add-template">
                    <div class="nav-card-icon">
                        <img src="icons/addTemplate.svg" alt="">
                    </div>
                    <div class="nav-card-content">
                        <h3>Add Template</h3>
                        <p>Create new templates from images with customizable settings</p>
                    </div>
                    <button id="openAddTemplate" class="nav-card-button primary-button">
                        Open <i data-feather="arrow-right"></i>
                    </button>
                </div>

                <div class="nav-card" data-section="templates">
                    <div class="nav-card-icon">
                        <img src="icons/manageTemplates.svg" alt="">
                    </div>
                    <div class="nav-card-content">
                        <h3>Manage Templates</h3>
                        <p>View, control, and monitor your active templates</p>
                    </div>
                    <button id="openManageTemplates" class="nav-card-button primary-button">
                        Open <i data-feather="arrow-right"></i>
                    </button>
                </div>

                <div class="nav-card" data-section="settings">
                    <div class="nav-card-icon">
                        <img src="icons/settings.svg" alt="">
                    </div>
                    <div class="nav-card-content">
                        <h3>Settings</h3>
                        <p>Configure application behavior and drawing preferences</p>
                    </div>
                    <button id="openSettings" class="nav-card-button primary-button">
                        Open <i data-feather="arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Management Section -->
        <div id="manageUsers" class="page-content">
            <div class="page-header">
                <h2>User Management</h2>
                <p class="page-description">Add and manage user accounts for template execution</p>
            </div>

            <div class="content-grid">
                <div class="form-card">
                    <h3>Add New User</h3>
                    <form id="userForm" class="form-layout">
                        <div class="input-group">
                            <label for="jcookie">JWT Cookie (j)</label>
                            <input type="password" id="jcookie" placeholder="Enter JWT cookie" required>
                            <span class="input-hint">Required for user authentication</span>
                        </div>
                        <div class="input-group">
                            <label for="scookie">Session Cookie (s)</label>
                            <input type="password" id="scookie" placeholder="Enter session cookie (optional)">
                            <span class="input-hint">Optional session identifier</span>
                        </div>
                        <div class="input-group">
                            <label for="expirationDate">Expiration Date</label>
                            <input type="datetime-local" id="expirationDate" placeholder="Optional expiration date">
                            <span class="input-hint">Optional expiration date for the cookie</span>
                        </div>
                        <button type="submit" id="submitUser" class="primary-button">
                            <img src="icons/addUser.svg">Add User
                        </button>
                    </form>
                </div>

                <div class="status-card">
                    <div class="status-header">
                        <h3>Account Overview</h3>
                        <button id="checkUserStatus" class="secondary-button">
                            <img src="icons/check.svg">Refresh Status
                        </button>
                    </div>
                    <div class="charge-summary" id="chargeSummary">
                        <div class="charge-stat">
                            <span class="charge-label">Available Charges</span>
                            <span class="charge-value" id="totalCharges">?</span>
                        </div>
                        <div class="charge-stat">
                            <span class="charge-label">Max Charges</span>
                            <span class="charge-value" id="totalMaxCharges">?</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="users-section">
                <h3 class="section-title">Active Users</h3>
                <div id="userList" class="user-grid"></div>
            </div>

            <div class="page-actions">
                <button onclick="changeTab('main');" class="secondary-button">
                    <img src="icons/return.svg">Back to Dashboard
                </button>
            </div>
        </div>

        <!-- Template Creation Section -->
        <div id="addTemplate" class="page-content">
            <div class="page-header">
                <h2 id="templateFormTitle">Create Template</h2>
                <p class="page-description">Upload and configure a new template for drawing</p>
            </div>

            <div class="template-upload-section">
                <div class="upload-actions">
                    <button class="primary-button upload-btn" onclick="document.getElementById('convertInput').click()">
                        <img src="icons/convert.svg">Convert Image
                    </button>
                    <button class="primary-button upload-btn" onclick="document.getElementById('addImage').click()">
                        <img src="icons/convert.svg">Add Image
                    </button>
                    <button id="linkToPage" class="secondary-button"
                        onclick="window.open('https://pepoafonso.github.io/color_converter_wplace/', '_blank')">
                        <img src="icons/check.svg">Convert with Tool
                    </button>
                </div>

                <input type="file" id="convertInput" accept="image/*" style="display: none;">
                <input type="file" id="addImage" accept="image/*" style="display: none;">
            </div>

            <div id="details" class="template-details">
                <div class="template-info">
                    <div class="info-stat">
                        <span class="info-label">Size:</span>
                        <span class="info-value" id="size"></span>
                    </div>
                    <div class="info-stat">
                        <span class="info-label">Charges needed:</span>
                        <span class="info-value" id="ink"></span>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="templateCanvas" class="template-canvas"></canvas>
                </div>

                <div class="preview-section">
                    <div class="preview-controls">
                        <button id="previewCanvasButton" class="secondary-button">Preview Canvas</button>
                        <div class="preview-border-control">
                            <label for="previewBorder">Preview Border:</label>
                            <input type="number" id="previewBorder" value="0" min="0">
                        </div>
                    </div>
                    <div class="canvas-container">
                        <canvas id="previewCanvas" class="preview-canvas"></canvas>
                    </div>
                </div>
            </div>

            <form id="templateForm" class="template-form">
                <input type="file" style="display: none;" accept="image/png" id="convertInput">

                <div class="form-section">
                    <h3>Template Configuration</h3>

                    <div class="settings-grid">
                        <div class="setting-toggle">
                            <div class="setting-info">
                                <label for="usePaidColors">Use paid colors when exact</label>
                                <span class="setting-description">Enable premium color palette</span>
                            </div>
                            <label class="switch">
                                <input id="usePaidColors" name="usePaidColors" type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="setting-toggle">
                            <div class="setting-info">
                                <label for="autoStart">Auto-start template</label>
                                <span class="setting-description">Automatically start template after creation</span>
                            </div>
                            <label class="switch">
                                <input id="autoStart" name="autoStart" type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="input-group">
                        <label for="templateName">Template Name</label>
                        <input type="text" id="templateName" placeholder="Enter a descriptive name" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Position Coordinates</h3>
                    <div class="coordinate-grid">
                        <div class="input-group">
                            <label for="tx">Tile X</label>
                            <input type="number" id="tx" placeholder="0" required>
                        </div>
                        <div class="input-group">
                            <label for="ty">Tile Y</label>
                            <input type="number" id="ty" placeholder="0" required>
                        </div>
                        <div class="input-group">
                            <label for="px">Pixel X</label>
                            <input type="number" id="px" placeholder="0" required>
                        </div>
                        <div class="input-group">
                            <label for="py">Pixel Y</label>
                            <input type="number" id="py" placeholder="0" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>User Selection</h3>
                    <div class="user-selection-header">
                        <label for="userSelectList">Assign Users</label>
                        <button type="button" id="selectAllUsers" class="secondary-button">
                            <img src="icons/manageUsers.svg">Select All
                        </button>
                    </div>
                    <div id="userSelectList" class="user-select-container"></div>
                </div>

                <div class="form-section">
                    <h3>Advanced Options</h3>
                    <div class="settings-grid">
                        <div class="setting-toggle">
                            <div class="setting-info">
                                <label for="canBuyMaxCharges">Buy max charge upgrades</label>
                                <span class="setting-description">Automatically purchase charge upgrades</span>
                            </div>
                            <label class="switch">
                                <input id="canBuyMaxCharges" name="canBuyMaxCharges" type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="setting-toggle">
                            <div class="setting-info">
                                <label for="canBuyCharges">Buy paint charges when low</label>
                                <span class="setting-description">Automatically purchase paint when needed</span>
                            </div>
                            <label class="switch">
                                <input id="canBuyCharges" name="canBuyCharges" type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="setting-toggle">
                            <div class="setting-info">
                                <label for="antiGriefMode">Anti-grief protection</label>
                                <span class="setting-description">Protect against vandalism</span>
                            </div>
                            <label class="switch">
                                <input id="antiGriefMode" name="antiGriefMode" type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" id="submitTemplate" class="primary-button">
                        <img src="icons/addTemplate.svg">Create Template
                    </button>
                </div>
            </form>

            <div class="page-actions">
                <button onclick="changeTab('main'); resetTemplateForm();" class="secondary-button">
                    <img src="icons/return.svg">Back to Dashboard
                </button>
            </div>
        </div>

        <!-- Template Management Section -->
        <div id="manageTemplates" class="page-content">
            <div class="page-header">
                <h2>Template Management</h2>
                <p class="page-description">Monitor and control your active templates</p>
            </div>

            <div class="template-actions-all">
                <button id="startAll" class="primary-button">
                    <img src="icons/playAll.svg">Start All Templates
                </button>
                <button id="stopAll" class="secondary-button">
                    <img src="icons/pauseAll.svg">Stop All Templates
                </button>
                <button id="refreshAll" class="secondary-button">
                    <img src="icons/restart.svg">Refresh Templates
                </button>
            </div>

            <div class="templates-section">
                <div id="templateList" class="template-grid"></div>
            </div>

            <div class="import-export-section">
                <div class="import-export-actions">
                    <h3>Template Management</h3>
                    <div class="import-export-buttons">
                        <button id="importTemplates" class="secondary-button">
                            <img src="icons/addTemplate.svg">Import Templates
                        </button>
                        <button id="exportAllTemplates" class="secondary-button">
                            <img src="icons/convert.svg">Export All Templates
                        </button>
                    </div>
                </div>

                <div class="page-actions">
                    <button onclick="changeTab('main');" class="secondary-button">
                        <img src="icons/return.svg">Back to Dashboard
                    </button>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="page-content">
                <div class="page-header">
                    <h2>Application Settings</h2>
                    <p class="page-description">Configure drawing behavior and application preferences</p>
                </div>

                <div class="settings-container">
                    <div class="form-section">
                        <h3>Drawing Configuration</h3>
                        <div class="input-group">
                            <label for="drawingDirection">Drawing Direction</label>
                            <select id="drawingDirection">
                                <option value="ttb">Top to Bottom</option>
                                <option value="btt">Bottom to Top</option>
                                <option value="ltr">Left to Right</option>
                                <option value="rtl">Right to Left</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="drawingOrder">Drawing Order</label>
                            <select id="drawingOrder">
                                <option value="linear">Linear</option>
                                <option value="random">Random</option>
                                <option value="color">Color by Color</option>
                                <option value="randomColor">Random Color Order</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>General Options</h3>
                        <div class="settings-grid">
                            <div class="setting-toggle">
                                <div class="setting-info">
                                    <label for="outlineMode">Outline mode</label>
                                    <span class="setting-description">Draw only the outline of templates</span>
                                </div>
                                <label class="switch">
                                    <input id="outlineMode" name="outlineMode" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-toggle">
                                <div class="setting-info">
                                    <label for="interleavedMode">Interleaved mode</label>
                                    <span class="setting-description">Alternate between different pixel patterns</span>
                                </div>
                                <label class="switch">
                                    <input id="interleavedMode" name="interleavedMode" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-toggle">
                                <div class="setting-info">
                                    <label for="skipPaintedPixels">Skip painted pixels</label>
                                    <span class="setting-description">Only paint blank pixels</span>
                                </div>
                                <label class="switch">
                                    <input id="skipPaintedPixels" name="skipPaintedPixels" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="setting-toggle">
                                <div class="setting-info">
                                    <label for="turnstileNotifications">Desktop notifications</label>
                                    <span class="setting-description">Show notifications for Turnstile challenges</span>
                                </div>
                                <label class="switch">
                                    <input id="turnstileNotifications" name="turnstileNotifications" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Timing & Thresholds</h3>
                        <div class="settings-grid">
                            <div class="input-group">
                                <label for="accountCooldown">Account Turn Cooldown (seconds)</label>
                                <input type="number" id="accountCooldown" min="0" value="20">
                                <span class="input-hint">Time between account switches</span>
                            </div>

                            <div class="input-group">
                                <label for="purchaseCooldown">Purchase Cooldown (seconds)</label>
                                <input type="number" id="purchaseCooldown" min="0" value="5">
                                <span class="input-hint">Delay between purchases</span>
                            </div>

                            <div class="input-group">
                                <label for="keepAliveCooldown">Keep Alive Cooldown (seconds)</label>
                                <input type="number" id="keepAliveCooldown" min="0" value="5">
                                <span class="input-hint">Delay between keep-alive checks</span>
                            </div>

                            <div class="input-group">
                                <label for="dropletReserve">Minimum Droplets Before Buying</label>
                                <input type="number" id="dropletReserve" min="0" value="0">
                                <span class="input-hint">Reserve droplets before making purchases</span>
                            </div>

                            <div class="input-group">
                                <label for="antiGriefStandby">Anti-Grief Standby Time (minutes)</label>
                                <input type="number" id="antiGriefStandby" min="1" value="10">
                                <span class="input-hint">Time to wait when template is complete</span>
                            </div>

                            <div class="input-group">
                                <label for="chargeThreshold">Charge Threshold (%)</label>
                                <input type="number" id="chargeThreshold" min="0" max="100" value="50">
                                <span class="input-hint">Minimum charge level before starting</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-actions">
                    <button onclick="changeTab('main');" class="secondary-button">
                        <img src="icons/return.svg">Back to Dashboard
                    </button>
                </div>
            </div>

            <!-- Footer -->
            <footer class="app-footer">
                <p class="credits">
                    Made by
                    <a href="https://github.com/luluwaffless" target="_blank" rel="noopener">
                        luluwaffless <img src="icons/github.svg" alt="GitHub">
                    </a>
                    and
                    <a href="https://github.com/JinxTheCatto" target="_blank" rel="noopener">
                        Jinx <img src="icons/github.svg" alt="GitHub">
                    </a>
                </p>
            </footer>
        </div>

        <!-- Modal Overlay -->
        <div id="messageBoxOverlay" class="modal-overlay hidden">
            <div id="messageBox" class="modal-content">
                <h3 id="messageBoxTitle" class="modal-title"></h3>
                <p id="messageBoxContent" class="modal-text"></p>
                <div class="modal-actions">
                    <button id="messageBoxCancel" class="secondary-button">Cancel</button>
                    <button id="messageBoxConfirm" class="primary-button">OK</button>
                </div>
            </div>
        </div>

        <script type="text/javascript" src="scripts/index.js"></script>
</body>

</html>