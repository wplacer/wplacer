<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="icons/favicon.png">
    <link rel="stylesheet" href="styles/index.css">
    <link rel="stylesheet" href="styles/fixes.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.11.0/axios.min.js"
        referrerpolicy="no-referrer"></script>
    <title>wplacer</title>
</head>

<body>
    <div class="container">
        <h1><img src="icons/favicon.png" alt="wplacer logo">wplacer</h1>

        <div id="main">
            <button id="openManageUsers" class="primary-button"><img src="icons/manageUsers.svg" alt="">Manage
                Users</button>
            <button id="openAddTemplate" class="primary-button"><img src="icons/addTemplate.svg" alt="">Add
                Template</button>
            <button id="openManageTemplates" class="primary-button"><img src="icons/manageTemplates.svg" alt="">Manage
                Templates</button>
            <button id="openLogsViewer" class="primary-button"><img src="icons/code.svg" alt="">View Logs</button>
            <button id="openSettings" class="primary-button"><img src="icons/settings.svg" alt="">Settings</button>
        </div>

        <div id="logsViewer" style="display: none;">
            <h2>Realtime Logs Viewer</h2>
            <input id="logsSearchInput" class="logs-search" type="text" placeholder="Search text...">
            <div class="logs-controls">
                <button id="showLogsBtn" class="secondary-button">Logs</button>
                <button id="showErrorsBtn" class="secondary-button">Errors</button>
                <button id="clearLogsBtn" class="secondary-button">Clear</button>
                <button id="logsExportBtn" class="secondary-button">Export</button>
                <select id="logsTypeFilter" class="logs-type-filter">
                    <option value="">All</option>
                    <option value="error">Error</option>
                    <option value="warn">Warning</option>
                    <option value="success">Success</option>
                    <option value="info">Info</option>
                </select>
            </div>
            <div id="logsContainer" class="logs-container"><span class="logs-placeholder">Loading logs...</span></div>
            <button onclick="changeTab('main');" class="secondary-button"><img src="icons/return.svg"
                    alt="">Return</button>
        </div>

        <div id="manageUsers" style="display: none;">
            <h2>Add/Manage Users</h2>
            <form id="userForm">
                <label for="jcookie">JWT Cookie (j)</label>
                <input type="password" id="jcookie" required>
                <label for="scookie">Session Cookie (s) [optional]</label>
                <input type="password" id="scookie">
                <button type="submit" id="submitUser" class="primary-button"><img src="icons/addUser.svg" alt="">Add
                    User</button>
            </form>
            <button id="deleteBannedUsersBtn" class="destructive-button" style="margin-top: 16px;"><img src="icons/remove.svg" alt="">Delete All Banned Accounts</button>

            <h2 class="section-title" id="manageUsersTitle">Existing Users</h2>
            <div id="chargeSummary">
                <b>Total Charges:</b> <span id="totalCharges">?</span>/<span id="totalMaxCharges">?</span> |
                <b>Total Droplets:</b> <span id="totalDroplets">?</span> |
                <b>PPH:</b> <span id="totalPPH">?</span>
            </div>
            <div class="user-actions">
                <button id="checkUserStatus" class="primary-button"><img src="icons/check.svg" alt="">Check Account Status</button>
                <button id="exportJTokens" class="secondary-button"><img src="icons/download.svg" alt="">Export J Tokens</button>
                <button id="importJTokens" class="secondary-button"><img src="icons/upload.svg" alt="">Import J Tokens</button>
                <input type="file" id="importJTokensInput" accept=".txt" style="display: none;">
            </div>
            <div id="userList"></div>

            <button onclick="changeTab('main');" class="secondary-button"><img src="icons/return.svg"
                    alt="">Return</button>
        </div>

        <div id="addTemplate" style="display: none;">
            <h2 id="templateFormTitle">Add Template</h2>
            <div class="info-box">
                <b>Tip:</b> For best results, process your image through the <a
                    href="https://pepoafonso.github.io/color_converter_wplace/" target="_blank"
                    rel="noopener noreferrer">wplace color converter</a> first!
            </div>
            <button id="convert" class="primary-button" onclick="document.getElementById('convertInput').click()"><img
                    src="icons/convert.svg" alt="">Convert Image</button>
            <div id="details" style="display: none;">
                <b>Size:</b> <span id="size"></span> | <b>Charges needed:</b> <span id="ink"></span>
                <canvas id="templateCanvas"></canvas>
                <div class="preview-controls">
                    <button id="previewCanvasButton" class="secondary-button">Preview Canvas</button>
                    <label for="previewBorder">Preview Border:</label>
                    <input type="text" inputmode="numeric" pattern="[0-9]*" id="previewBorder" value="0">
                </div>
                <canvas id="previewCanvas" style="display: none;"></canvas>
            </div>
            <form id="templateForm">
                <input type="file" style="display: none;" accept="image/png" id="convertInput">
                <label for="templateName">Template Name</label>
                <input type="text" id="templateName" placeholder="Insert a catchy name here" required>
                <label>Coordinates (Ctrl-V anywhere to paste pin coordinates or a list of 4 numbers)</label>
                <div class="coordinate-grid">
                    <input type="text" inputmode="numeric" pattern="[0-9]*" id="tx" placeholder="Tile X" required>
                    <input type="text" inputmode="numeric" pattern="[0-9]*" id="ty" placeholder="Tile Y" required>
                    <input type="text" inputmode="numeric" pattern="[0-9]*" id="px" placeholder="Pixel X" required>
                    <input type="text" inputmode="numeric" pattern="[0-9]*" id="py" placeholder="Pixel Y" required>
                </div>
                <label for="userSelectList">Users</label>
                <div id="userSelectList"></div>
                <button type="button" id="selectAllUsers" class="secondary-button"><img src="icons/manageUsers.svg"
                        alt="">Select All</button>

                <div class="setting-toggle">
                    <label for="canBuyMaxCharges">Buy Max Charge Upgrades</label>
                    <label class="switch">
                        <input id="canBuyMaxCharges" name="canBuyMaxCharges" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-toggle">
                    <label for="canBuyCharges">Buy Paint Charges</label>
                    <label class="switch">
                        <input id="canBuyCharges" name="canBuyCharges" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-toggle">
                    <label for="antiGriefMode">Enable Anti-Grief Mode</label>
                    <label class="switch">
                        <input id="antiGriefMode" name="antiGriefMode" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-toggle">
                    <label for="eraseMode">Paint Transparent Pixels</label>
                    <label class="switch">
                        <input id="eraseMode" name="eraseMode" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-toggle">
                    <label for="templateOutlineMode">Enable Outline Mode</label>
                    <label class="switch">
                        <input id="templateOutlineMode" name="templateOutlineMode" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-toggle">
                    <label for="templateSkipPaintedPixels">Skip Others' Painted Pixels</label>
                    <label class="switch">
                        <input id="templateSkipPaintedPixels" name="templateSkipPaintedPixels" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-toggle">
                    <label for="enableAutostart">Enable Autostart</label>
                    <label class="switch">
                        <input id="enableAutostart" name="enableAutostart" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <h3>Reorder Colors</h3>
                <div class="color-grid" id="colorGrid"></div>

                <button class="btn-danger" onclick="resetOrder()">Reset to Default</button>

                <button type="submit" id="submitTemplate" class="primary-button"><img src="icons/addTemplate.svg"
                        alt="">Add Template</button>
            </form>
            <button onclick="changeTab('main'); resetTemplateForm();" class="secondary-button"><img
                    src="icons/return.svg" alt="">Return</button>
        </div>

        <div id="manageTemplates" style="display: none;">
            <h2>Manage Templates</h2>
            <div class="template-actions-all">
                <button id="startAll" class="primary-button"><img src="icons/playAll.svg" alt="">Start All</button>
                <button id="stopAll" class="secondary-button"><img src="icons/pauseAll.svg" alt="">Stop All</button>
            </div>
            <div id="templateList"></div>
            <button onclick="changeTab('main');" class="secondary-button"><img src="icons/return.svg"
                    alt="">Return</button>
        </div>

        <div id="settings" style="display: none;">
            <h2>Settings</h2>

            <div class="setting-toggle">
                <label for="openBrowserOnStart">Open Browser on Startup</label>
                <label class="switch">
                    <input id="openBrowserOnStart" name="openBrowserOnStart" type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>

            <label for="drawingDirectionSelect">Drawing Direction</label>
            <select id="drawingDirectionSelect">
                <option value="ttb">Top to Bottom</option>
                <option value="btt">Bottom to Top</option>
                <option value="ltr">Left to Right</option>
                <option value="rtl">Right to Left</option>
                <option value="center_out">Center Out</option>
                <option value="random">Random Pixels</option>
            </select>

            <label for="drawingOrderSelect">Drawing Order</label>
            <select id="drawingOrderSelect">
                <option value="linear">Linear</option>
                <option value="randomColor">Random Color</option>
                <option value="color">Color by Color</option>
            </select>

            <label for="pixelSkipSelect">Drawing Density</label>
            <select id="pixelSkipSelect">
                <option value="1">1/1 (Every Pixel)</option>
                <option value="2">1/2</option>
                <option value="4">1/4</option>
                <option value="8">1/8</option>
                <option value="16">1/16</option>
                <option value="32">1/32</option>
                <option value="64">1/64</option>
                <option value="128">1/128</option>
            </select>

            <label for="accountCooldown">Account Turn Cooldown (seconds)</label>
            <input type="number" id="accountCooldown" min="0" value="20">
            <label for="purchaseCooldown">Purchase Cooldown (seconds)</label>
            <input type="number" id="purchaseCooldown" min="0" value="5">
            <label for="accountCheckCooldown">Account Check Cooldown (seconds)</label>
            <input type="number" id="accountCheckCooldown" min="0" value="0">
            <label for="dropletReserve">Minimum Droplets Before Buying</label>
            <input type="number" id="dropletReserve" min="0" value="0">
            <label for="antiGriefStandby">Anti-Grief Standby Time (minutes)</label>
            <input type="number" id="antiGriefStandby" min="1" value="10">
            <label for="chargeThreshold">Charge Threshold (%)</label>
            <input type="number" id="chargeThreshold" min="0" max="100" value="50">

            <h2 class="section-title">Proxy Settings</h2>
            <div class="setting-toggle">
                <label for="proxyEnabled">Enable Rotating Proxies</label>
                <label class="switch">
                    <input id="proxyEnabled" name="proxyEnabled" type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div id="proxyFormContainer" style="display: none;">
                <p class="info-box" style="text-align: left;">Proxies are loaded from the <code>proxies.txt</code> file
                    in your <code>/data</code> folder. Add one proxy per line in the format
                    <code>protocol://user:pass@host:port</code>. You can get high quality proxies at <a
                        href="https://dataimpulse.com/?aff=199137" target="_blank"
                        rel="noopener noreferrer">DataImpulse</a>.</p>
                <div class="setting-toggle">
                    <label for="logProxyUsage">Log Proxy Connections</label>
                    <label class="switch">
                        <input id="logProxyUsage" name="logProxyUsage" type="checkbox">
                        <span class="slider"></span>
                    </label>
                </div>
                <label for="proxyRotationMode">Rotation Mode</label>
                <select id="proxyRotationMode">
                    <option value="sequential">Sequential</option>
                    <option value="random">Random</option>
                </select>
                <div id="proxyCount" class="info-box" style="text-align: center; margin-top: 10px;"></div>
                <button type="button" id="reloadProxiesBtn" class="secondary-button"><img src="icons/restart.svg" alt="">Reload Proxies from File</button>
            </div>

            <button onclick="changeTab('main');" class="secondary-button"><img src="icons/return.svg"
                    alt="">Return</button>
        </div>

        <p class="credits">
        Made by 
        <a href="https://github.com/luluwaffless">
            luluwaffless <img src="https://avatars.githubusercontent.com/u/96322105?v=4" alt="GitHub">
        </a> 
        and 
        <a href="https://github.com/JinxTheCatto">
            Jinx <img src="https://avatars.githubusercontent.com/u/59938808?v=4.png" alt="GitHub">
        </a>

        <!-- Small GIF -->
        <img 
            src="icons/jazzhands.webp" 
            alt="Cute cat" 
            class="credits-gif">
        </p>

    </div>

    <div id="messageBoxOverlay" class="hidden">
        <div id="messageBox">
            <h3 id="messageBoxTitle"></h3>
            <p id="messageBoxContent"></p>
            <div class="message-box-buttons">
                <button id="messageBoxCancel" class="secondary-button">Cancel</button>
                <button id="messageBoxConfirm" class="primary-button">OK</button>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="scripts/index.js"></script>
    <script type="text/javascript" src="scripts/improvements.js"></script>
</body>

</html>